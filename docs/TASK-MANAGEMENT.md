# 任务管理规范 (Task Management Guidelines)

本文档定义了 `heimdall` 项目的任务执行标准、完成验收标准、状态管理流程和严格的任务执行顺序控制。

## 1. 任务分类体系

### 1.1. 任务优先级分类

- **P0 - 阻塞任务**: 阻塞后续开发的关键任务，必须最优先完成
- **P1 - 核心任务**: MVP功能的核心实现，按序执行
- **P2 - 增强任务**: 功能增强和优化，可在P1完成后执行
- **P3 - 优化任务**: 性能优化、代码重构等，可延后执行

### 1.2. 任务类型分类

- **🏗️ Architecture**: 架构设计、规范制定
- **📝 API**: API接口设计和定义
- **🗃️ Model**: 数据模型设计和实现
- **🔧 DAO**: 数据访问层实现
- **💼 Logic**: 业务逻辑实现
- **🧪 Test**: 单元测试和集成测试
- **📚 Doc**: 文档编写和更新
- **🐛 Bug**: Bug修复
- **♻️ Refactor**: 代码重构

## 2. 任务定义标准

### 2.1. 任务命名规范

```
[优先级][类型] 任务简述 (#issue-number)

示例:
- [P1][Model] 实现User数据模型 (#001)
- [P1][API] 设计用户登录注册接口 (#002)
- [P1][DAO] 实现UserDAO数据访问层 (#003)
```

### 2.2. 任务描述必需内容

每个任务必须包含以下信息：

```markdown
## 任务描述
明确的任务目标和期望结果

## 验收标准 (Definition of Done)
- [ ] 具体的可验证的完成标准1
- [ ] 具体的可验证的完成标准2
- [ ] ...

## 前置依赖
- 依赖的任务列表（如果有）

## 技术要求
- 需要遵循的具体规范
- 需要使用的技术栈
- 需要实现的具体功能点

## 文件清单
- 需要创建/修改的文件列表

## 测试要求
- 需要编写的测试类型
- 测试覆盖率要求
```

## 3. 任务完成验收标准 (Definition of Done)

### 3.1. 通用验收标准

**所有任务都必须满足以下基础标准：**

- [ ] **代码编译**: 代码能够无错误编译通过
- [ ] **代码规范**: 遵循项目的所有编码规范
- [ ] **测试通过**: 所有相关测试必须通过
- [ ] **文档更新**: 必要的文档已更新
- [ ] **状态更新**: 任务状态已在任务清单中更新

### 3.2. 特定类型任务的验收标准

#### Model 任务
- [ ] MongoDB集合对应的Go struct已定义
- [ ] BSON标签正确设置
- [ ] 字段验证方法已实现（如需要）
- [ ] 符合 `MONGODB-MODELING-GUIDELINES.md` 规范

#### API 任务
- [ ] `.api` 文件已更新
- [ ] 符合 `API-DESIGN-GUIDELINES.md` 规范
- [ ] 使用 `goctl` 重新生成代码
- [ ] 错误响应格式统一

#### DAO 任务
- [ ] 数据访问接口已定义
- [ ] MongoDB操作已实现
- [ ] 错误处理完整
- [ ] 单元测试覆盖率 ≥ 85%

#### Logic 任务
- [ ] 业务逻辑已实现
- [ ] 错误处理完整
- [ ] 依赖注入正确
- [ ] 单元测试覆盖率 ≥ 85%
- [ ] 遵循TDD开发流程

#### Test 任务
- [ ] 使用 `goconvey` 和 `mockey` 框架
- [ ] 测试场景覆盖完整（正常+异常）
- [ ] Mock所有外部依赖
- [ ] 测试可独立运行

## 4. 任务状态管理

### 4.1. 任务状态定义

- **📋 TODO**: 待开始，所有前置依赖已完成
- **🚧 IN_PROGRESS**: 进行中，正在开发
- **👀 IN_REVIEW**: 开发完成，待验收
- **✅ DONE**: 已完成，通过所有验收标准
- **❌ BLOCKED**: 被阻塞，等待前置依赖或外部条件
- **⏸️ ON_HOLD**: 暂停，等待决策或优先级调整

### 4.2. 状态流转规则

```
📋 TODO → 🚧 IN_PROGRESS → 👀 IN_REVIEW → ✅ DONE
    ↓              ↓              ↓
  ❌ BLOCKED    ❌ BLOCKED    📋 TODO (返工)
    ↓              ↓
  ⏸️ ON_HOLD   ⏸️ ON_HOLD
```

### 4.3. 状态更新要求

- **状态变更必须记录**: 每次状态变更都要在任务清单中记录时间和原因
- **阻塞原因说明**: BLOCKED状态必须详细说明阻塞原因
- **返工原因记录**: 从IN_REVIEW返回TODO必须说明返工原因

## 5. 严格执行顺序控制

### 5.1. 顺序执行原则

- **串行执行**: 同一模块内的任务必须严格按顺序执行
- **依赖检查**: 开始任务前必须验证所有前置依赖已完成
- **阻塞处理**: 任何任务被阻塞时，不能跳过执行后续任务
- **分支控制**: 不同模块的任务可以并行，但模块内部必须串行

### 5.2. 任务启动检查清单

开始任务前必须确认：

- [ ] 前置依赖任务状态为 ✅ DONE
- [ ] 当前任务状态为 📋 TODO  
- [ ] 开发环境准备就绪
- [ ] 相关规范文档已阅读
- [ ] 任务描述和验收标准已理解

### 5.3. 任务执行流程

```
1. 📋 将任务状态更新为 🚧 IN_PROGRESS
2. 🔍 按照任务描述开始开发
3. ✅ 自检所有验收标准
4. 👀 将任务状态更新为 👀 IN_REVIEW
5. 🔬 进行代码审查和测试验证
6. ✅ 通过验收，状态更新为 ✅ DONE
7. 📝 更新任务清单和项目状态文档
```

## 6. 任务清单管理

### 6.1. 任务清单位置

所有任务清单维护在 `PROJECT-STATUS.md` 文件中，按以下结构组织：

```markdown
## 🚀 **下一步开发计划**

### 第一阶段：核心内容管理 (MVP)

#### 1.1 用户认证与管理 (Admin API)
- [x] [P1][Model] 定义User数据模型 ✅ DONE (2024-01-01)
- [ ] [P1][DAO] 实现UserDAO数据访问层 📋 TODO  
- [ ] [P1][API] 设计用户登录/注册接口 📋 TODO
```

### 6.2. 更新规则

- **实时更新**: 任务状态变更时立即更新
- **时间记录**: 记录任务完成的具体时间
- **进度追踪**: 维护每个阶段的完成百分比

### 6.3. 任务清单检查

每日开发开始前必须：

- [ ] 检查当前可执行的任务
- [ ] 确认任务执行顺序
- [ ] 识别潜在的阻塞风险
- [ ] 更新任务优先级（如需要）

## 7. 质量保证机制

### 7.1. 任务审查检查点

- **启动检查**: 任务开始前的依赖和准备检查
- **进度检查**: 开发过程中的里程碑检查
- **完成检查**: 任务完成时的验收标准检查
- **回顾检查**: 任务完成后的经验总结

### 7.2. 问题处理流程

- **立即记录**: 遇到问题立即在任务中记录
- **影响评估**: 评估对后续任务的影响
- **解决方案**: 制定解决方案或调整计划
- **状态更新**: 及时更新任务状态

## 8. AI协作者执行规范

### 8.1. AI任务执行要求

作为AI协作者，在执行任务时必须：

- [ ] **任务确认**: 开始前确认任务描述和验收标准
- [ ] **顺序检查**: 验证前置依赖任务已完成
- [ ] **规范遵循**: 严格按照项目规范执行
- [ ] **状态更新**: 及时更新任务状态
- [ ] **结果验证**: 完成后自检所有验收标准

### 8.2. AI任务报告格式

每个任务完成后，AI必须提供以下格式的报告：

```markdown
## 任务完成报告

**任务**: [P1][Model] 定义User数据模型 (#001)
**状态**: ✅ DONE
**完成时间**: 2024-01-01 14:30

### 完成的工作
- [x] 创建 common/model/user.go
- [x] 定义User结构体及BSON标签
- [x] 实现IsActive()验证方法

### 验收标准检查
- [x] MongoDB集合对应的Go struct已定义
- [x] BSON标签正确设置
- [x] 符合MONGODB-MODELING-GUIDELINES.md规范

### 下一个任务
下一个可执行任务: [P1][DAO] 实现UserDAO数据访问层 (#002)
```

---

**本规范是项目执行的核心准则，所有开发活动都必须严格遵循。** 