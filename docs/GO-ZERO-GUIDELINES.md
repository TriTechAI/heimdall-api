# Go-Zero å¼€å‘è§„èŒƒ

æœ¬æ–‡æ¡£æ—¨åœ¨ä¸ºåŸºäº go-zero æ¡†æ¶çš„é¡¹ç›®æä¾›ä¸€å¥—ç»Ÿä¸€çš„å¼€å‘æ ‡å‡†å’Œæœ€ä½³å®è·µï¼Œä»¥ç¡®ä¿ä»£ç çš„å¯è¯»æ€§ã€å¯ç»´æŠ¤æ€§å’Œå›¢é˜Ÿåä½œæ•ˆç‡ã€‚

## 1. æ ¸å¿ƒåŸåˆ™ï¼šAPI-First

**æ‰€æœ‰å¼€å‘æ´»åŠ¨éƒ½å¿…é¡»ä»¥ API å®šä¹‰ä¸ºèµ·ç‚¹ã€‚**

- **å”¯ä¸€äº‹å®æ¥æº (Single Source of Truth)**: é¡¹ç›®ä¸­æ‰€æœ‰çš„ API è·¯ç”±ã€è¯·æ±‚/å“åº”ç»“æ„ä½“ã€æœåŠ¡å®šä¹‰ï¼Œéƒ½**å¿…é¡»**åœ¨ `.api` æ–‡ä»¶ä¸­è¿›è¡Œæè¿°ã€‚`.api` æ–‡ä»¶æ˜¯é¡¹ç›®æ¥å£çš„å”¯ä¸€æƒå¨æ¥æºã€‚
- **ä»£ç ç”Ÿæˆé©±åŠ¨**:
  - ä¸¥ç¦æ‰‹åŠ¨åˆ›å»ºæˆ–ä¿®æ”¹ `handler`ã€`types`ã€`routes` ç­‰ç”± `goctl` ç”Ÿæˆçš„ä»£ç ã€‚
  - **æ ‡å‡†å·¥ä½œæµ**:
    1.  **å®šä¹‰**: åœ¨ `.api` æ–‡ä»¶ä¸­æ·»åŠ æˆ–ä¿®æ”¹ API å®šä¹‰ã€‚
    2.  **ç”Ÿæˆ**: è¿è¡Œ `goctl api go -api <your-api-file>.api -dir . --style=goZero` å‘½ä»¤é‡æ–°ç”Ÿæˆä»£ç ã€‚
    3.  **å®ç°**: åœ¨ `internal/logic` ç›®å½•ä¸­æ‰¾åˆ°å¯¹åº”çš„ `logic` æ–‡ä»¶ï¼Œå¹¶å¡«å……ä¸šåŠ¡é€»è¾‘ã€‚

## 2. ç›®å½•ç»“æ„ä¸èŒè´£åˆ’åˆ†

ä¸¥æ ¼éµå®ˆ `go-zero` çš„ç›®å½•ç»“æ„çº¦å®šï¼Œå¹¶ç»“åˆä»¥ä¸‹è‡ªå®šä¹‰è§„èŒƒï¼Œç¡®ä¿å„æ¨¡å—èŒè´£æ¸…æ™°ã€‚

### 2.1. å¤šæœåŠ¡æ¶æ„æ€»è§ˆ

æˆ‘ä»¬é‡‡ç”¨å¾®æœåŠ¡æ¶æ„ï¼Œå°† `heimdall` é¡¹ç›®æ‹†åˆ†ä¸ºä¸¤ä¸ªç‹¬ç«‹çš„æœåŠ¡ï¼š

```
heimdall-api/
â”œâ”€â”€ go.mod                      # ç»Ÿä¸€çš„æ¨¡å—å®šä¹‰æ–‡ä»¶
â”œâ”€â”€ admin-api/                  # åå°ç®¡ç†æœåŠ¡
â”‚   â””â”€â”€ admin/                  # goctlç”Ÿæˆçš„æœåŠ¡ä»£ç 
â”‚       â”œâ”€â”€ admin.go
â”‚       â”œâ”€â”€ admin.api
â”‚       â”œâ”€â”€ etc/
â”‚       â””â”€â”€ internal/
â”‚           â”œâ”€â”€ handler/
â”‚           â”œâ”€â”€ logic/
â”‚           â”œâ”€â”€ svc/
â”‚           â”œâ”€â”€ types/
â”‚           â”œâ”€â”€ config/
â”‚           â””â”€â”€ middleware/
â”œâ”€â”€ public-api/                 # å‰å°å…¬å¼€æœåŠ¡  
â”‚   â””â”€â”€ public/                 # goctlç”Ÿæˆçš„æœåŠ¡ä»£ç 
â”‚       â”œâ”€â”€ public.go
â”‚       â”œâ”€â”€ public.api
â”‚       â”œâ”€â”€ etc/
â”‚       â””â”€â”€ internal/
â”‚           â”œâ”€â”€ handler/
â”‚           â”œâ”€â”€ logic/
â”‚           â”œâ”€â”€ svc/
â”‚           â”œâ”€â”€ types/
â”‚           â”œâ”€â”€ config/
â”‚           â””â”€â”€ middleware/
â”œâ”€â”€ common/                     # å…±äº«ä»£ç åŒ…
â”‚   â”œâ”€â”€ dao/                    # æ•°æ®è®¿é—®å±‚
â”‚   â”œâ”€â”€ model/                  # æ•°æ®æ¨¡å‹
â”‚   â”œâ”€â”€ constants/              # å…±äº«å¸¸é‡
â”‚   â”œâ”€â”€ client/                 # ç¬¬ä¸‰æ–¹æœåŠ¡å®¢æˆ·ç«¯
â”‚   â””â”€â”€ errors/                 # ä¸šåŠ¡é”™è¯¯å®šä¹‰
â””â”€â”€ [è§„èŒƒæ–‡æ¡£...]
```

### 2.2. æœåŠ¡èŒè´£åˆ’åˆ†

- **`admin-api`**: 
  - **ç”¨é€”**: åšå®¢ç®¡ç†åå°ï¼Œé¢å‘ä½œè€…ã€ç¼–è¾‘ã€ç®¡ç†å‘˜
  - **ä¸»è¦åŠŸèƒ½**: ç”¨æˆ·è®¤è¯ã€æ–‡ç« CRUDã€è¯„è®ºç®¡ç†ã€ç³»ç»Ÿè®¾ç½®ã€æ•°æ®ç»Ÿè®¡
  - **å®‰å…¨çº§åˆ«**: é«˜ï¼Œé€šè¿‡å¤šé‡èº«ä»½éªŒè¯å’Œæƒé™æ§åˆ¶ç¡®ä¿å®‰å…¨
  - **è®¿é—®é‡**: ä½ï¼Œä¸»è¦æ˜¯ç®¡ç†äººå‘˜ä½¿ç”¨

- **`public-api`**:
  - **ç”¨é€”**: åšå®¢å‰å°ï¼Œé¢å‘å…¬ä¼—è¯»è€…  
  - **ä¸»è¦åŠŸèƒ½**: æ–‡ç« å±•ç¤ºã€è¯„è®ºæŸ¥çœ‹ã€æœç´¢ã€æ ‡ç­¾æµè§ˆ
  - **å®‰å…¨çº§åˆ«**: å…¬å¼€ï¼Œéœ€è¦é˜²èŒƒå„ç§ç½‘ç»œæ”»å‡»
  - **è®¿é—®é‡**: é«˜ï¼Œéœ€è¦è€ƒè™‘æ€§èƒ½ä¼˜åŒ–å’Œç¼“å­˜

- **`common`**:
  - **ç”¨é€”**: ä¸¤ä¸ªæœåŠ¡å…±äº«çš„æ ¸å¿ƒä¸šåŠ¡ä»£ç 
  - **åŒ…å«**: æ•°æ®æ¨¡å‹ã€æ•°æ®è®¿é—®å±‚ã€ä¸šåŠ¡å¸¸é‡ã€ç¬¬ä¸‰æ–¹å®¢æˆ·ç«¯ç­‰
  - **åŸåˆ™**: åªåŒ…å«çº¯ä¸šåŠ¡é€»è¾‘ï¼Œä¸åŒ…å«HTTPç›¸å…³ä»£ç 

### 2.3. å•ä¸ªæœåŠ¡å†…éƒ¨ç»“æ„

æ¯ä¸ªæœåŠ¡ (`admin-api`, `public-api`) å†…éƒ¨ä¸¥æ ¼éµå®ˆ go-zero çš„æ ‡å‡†ç»“æ„ï¼š

- `etc/`: ä»…ç”¨äºå­˜æ”¾é¡¹ç›®é…ç½®æ–‡ä»¶ (`.yaml`)ã€‚
- `internal/config/`: ç”± `goctl` ç”Ÿæˆçš„é…ç½®ç»“æ„ä½“ã€‚**ç¦æ­¢æ‰‹åŠ¨ä¿®æ”¹**ã€‚
- `internal/handler/`: **ä¿æŒç²¾ç®€**ã€‚Handler ä»…è´Ÿè´£è§£æè¯·æ±‚ã€è°ƒç”¨ `logic` å±‚ã€å¹¶è¿”å›å“åº”ã€‚**ä¸¥ç¦åœ¨ Handler ä¸­ç¼–å†™ä»»ä½•ä¸šåŠ¡é€»è¾‘ã€‚**
- `internal/logic/`: **æ ¸å¿ƒä¸šåŠ¡é€»è¾‘å±‚**ã€‚è´Ÿè´£ç¼–æ’å’Œç»„åˆä¸šåŠ¡æµç¨‹ã€‚å®ƒè°ƒç”¨ `common/dao` å±‚è¿›è¡Œæ•°æ®æŒä¹…åŒ–ï¼Œè°ƒç”¨ `common/client` å±‚ä¸ç¬¬ä¸‰æ–¹æœåŠ¡äº¤äº’ã€‚
- `internal/svc/`: **æœåŠ¡ä¸Šä¸‹æ–‡ (ServiceContext)**ã€‚ä½œä¸ºä¾èµ–æ³¨å…¥çš„å®¹å™¨ã€‚åœ¨æ­¤åˆå§‹åŒ–å¹¶æŒæœ‰é¡¹ç›®æ‰€éœ€çš„å…¨éƒ¨å¤–éƒ¨ä¾èµ–ï¼ˆé…ç½®ã€DAO å®ä¾‹ã€ç¬¬ä¸‰æ–¹æœåŠ¡ Client ç­‰ï¼‰ï¼Œå¹¶æ³¨å…¥åˆ° `logic` å±‚ã€‚
- `internal/types/`: ç”± `goctl` è‡ªåŠ¨ç”Ÿæˆï¼Œå­˜æ”¾ API çš„è¯·æ±‚å’Œå“åº”ç»“æ„ä½“ã€‚**ç¦æ­¢æ‰‹åŠ¨ä¿®æ”¹**ã€‚
- `internal/middleware/`: å­˜æ”¾æœåŠ¡ç‰¹æœ‰çš„ä¸­é—´ä»¶ã€‚

### 2.4. å…±äº«æ¨¡å—ç»“æ„ (`common/`)

- `common/model/`: **ï¼ˆæ‰‹åŠ¨åˆ›å»ºï¼‰æ¨¡å‹å®šä¹‰å±‚**ã€‚
  - **åªå­˜æ”¾**ä¸æ•°æ®è¡¨ä¸€ä¸€æ˜ å°„çš„ Go `struct` å®šä¹‰ã€‚
  - å¯ä»¥åŒ…å«æ¨¡å‹è‡ªèº«çš„ä¸€äº›ç®€å•ã€æ— ä¾èµ–çš„æ–¹æ³•ï¼ˆä¾‹å¦‚ `IsPublished()`)ã€‚
  - **ä¸¥ç¦**åœ¨æ­¤å±‚åŒ…å«ä»»ä½•æ•°æ®åº“æ“ä½œï¼ˆCURDï¼‰ä»£ç ã€‚
- `common/dao/`: **ï¼ˆæ‰‹åŠ¨åˆ›å»ºï¼‰æ•°æ®è®¿é—®å±‚ (Data Access Object)**ã€‚
  - **ä¸“é—¨ç”¨äºä¸æ•°æ®åº“äº¤äº’**ã€‚
  - ä¸ºæ¯ä¸ª `model` å®šä¹‰ä¸€ä¸ª `interface` å’Œå®ƒçš„å®ç°ã€‚ä¾‹å¦‚ `user_dao.go` åŒ…å« `UserDao` æ¥å£å’Œ `NewUserDao(...)`ã€‚
  - è´Ÿè´£æ‰€æœ‰ SQL/ORM æ“ä½œã€‚`logic` å±‚é€šè¿‡è°ƒç”¨ `dao` å±‚çš„æ¥å£æ¥æ“ä½œæ•°æ®ã€‚
- `common/client/`: **ï¼ˆæ‰‹åŠ¨åˆ›å»ºï¼‰ç¬¬ä¸‰æ–¹æœåŠ¡å®¢æˆ·ç«¯å±‚**ã€‚
  - å°è£…å¯¹å¤–éƒ¨ç¬¬ä¸‰æ–¹ API (å¦‚é‚®ä»¶æœåŠ¡ã€æ”¯ä»˜ç½‘å…³ç­‰) çš„è°ƒç”¨ã€‚
  - æ¯ä¸ªç¬¬ä¸‰æ–¹æœåŠ¡å¯¹åº”ä¸€ä¸ªå­ç›®å½•ï¼Œä¾‹å¦‚ `common/client/mailgun/`ã€‚
- `common/constants/`: å­˜æ”¾æ‰€æœ‰å…±äº«å¸¸é‡ï¼ˆé­”æ³•å­—ç¬¦ä¸²ã€æ•°å­—ç­‰ï¼‰ã€‚
- `common/errors/`: **æ¨èåˆ›å»º**ï¼Œç”¨äºå®šä¹‰ä¸šåŠ¡é”™è¯¯ç±»å‹ã€‚

## 3. API å®šä¹‰è§„èŒƒ (`.api` æ–‡ä»¶)

- **å‘½åè§„èŒƒ**:
  - `type` åç§°ä½¿ç”¨ `PascalCase`ã€‚
  - `type` ä¸­çš„å­—æ®µåä½¿ç”¨ `PascalCase`ã€‚å¯¹åº”çš„ `json` æ ‡ç­¾ä½¿ç”¨ `camelCase`ã€‚
  - è·¯ç”± Handler åç§°åº”æ¸…æ™°æè¿°å…¶åŠŸèƒ½ï¼Œä¾‹å¦‚ `GetUserById`ã€‚
- **æ³¨é‡Š**:
  - å¿…é¡»ä¸ºæ¯ä¸ª `service`ã€`route`ã€å’Œ `type` ä¸­çš„å…³é”®å­—æ®µæ·»åŠ æ¸…æ™°çš„æ³¨é‡Šï¼Œè§£é‡Šå…¶ç”¨é€”ã€‚
- **ç‰ˆæœ¬ç®¡ç†**: æ¨èåœ¨ API è·¯ç”±ä¸­åŒ…å«ç‰ˆæœ¬æ ‡è¯†ï¼Œä¾‹å¦‚ `@server(prefix=/api/v1)`ã€‚
- **è·¯ç”±è§„åˆ™**:
  - å‘½åé‡‡ç”¨ RESTful é£æ ¼ã€‚
  - ä½¿ç”¨ `@doc("...")` æè¿°æ¥å£åŠŸèƒ½ã€‚
  - ä½¿ç”¨ `@handler ...` æŒ‡å®š handler åç§°ã€‚

**ç¤ºä¾‹:**
```api
type (
    // ç”¨æˆ·ç™»å½•è¯·æ±‚
    LoginReq {
        Username string `json:"username"` // ç”¨æˆ·å
        Password string `json:"password"` // å¯†ç 
    }

    // ç”¨æˆ·ç™»å½•å“åº”
    LoginReply {
        AccessToken  string `json:"accessToken"`
        AccessExpire int64  `json:"accessExpire"`
    }
)

@server(
    jwt: Auth
    prefix: /api/v1/users
)
service user {
    @doc("ç”¨æˆ·ç™»å½•")
    @handler login
    post /login (LoginReq) returns (LoginReply)
}
```

## 4. é”™è¯¯å¤„ç†

- **Logic å±‚**:
  - ä¸šåŠ¡é€»è¾‘ä¸­é‡åˆ°é”™è¯¯æ—¶ï¼Œåº”ç«‹å³ `return nil, err`ï¼Œå°†é”™è¯¯å‘ä¸Šä¼ é€’ã€‚
  - æ¨èè°ƒç”¨ `internal/errors/` ä¸­é¢„å®šä¹‰çš„ä¸šåŠ¡é”™è¯¯ï¼Œè€Œä¸æ˜¯ç›´æ¥è¿”å› `errors.New("...")`ã€‚
- **Handler å±‚**:
  - `go-zero` é»˜è®¤çš„ `httpx.OkJson` å’Œ `httpx.Error` ä¼šå¤„ç†å¤§éƒ¨åˆ†æƒ…å†µã€‚
  - å¯é€šè¿‡è‡ªå®šä¹‰ä¸­é—´ä»¶æˆ–æ”¹å†™ `httpx.SetErrorHandler` æ¥å®ç°æ›´å¤æ‚çš„å…¨å±€é”™è¯¯å¤„ç†é€»è¾‘ï¼ˆä¾‹å¦‚ï¼Œå°†ä¸åŒç±»å‹çš„ `error` æ˜ å°„ä¸ºä¸åŒçš„ HTTP çŠ¶æ€ç å’Œå“åº”æ ¼å¼ï¼‰ã€‚

## 5. å‡½æ•°åŸå­åŒ–è§„èŒƒ

ä¸ºäº†æé«˜ä»£ç çš„å¯è¯»æ€§ã€å¯ç»´æŠ¤æ€§å’Œå¯æµ‹è¯•æ€§ï¼Œé¡¹ç›®ä¸­çš„æ‰€æœ‰å‡½æ•°éƒ½å¿…é¡»éµå¾ªåŸå­åŒ–è®¾è®¡åŸåˆ™ã€‚

### 5.1. å‡½æ•°é•¿åº¦é™åˆ¶

- **å»ºè®®ä¸Šé™**: å•ä¸ªå‡½æ•°ä¸è¶…è¿‡ **40è¡Œ** ä»£ç ï¼ˆä¸åŒ…æ‹¬ç©ºè¡Œå’Œæ³¨é‡Šï¼‰
- **å¼ºåˆ¶ä¸Šé™**: å•ä¸ªå‡½æ•°ä¸è¶…è¿‡ **50è¡Œ** ä»£ç 
- **ç†æƒ³é•¿åº¦**: 15-25è¡Œæ˜¯æœ€ä½³å®è·µèŒƒå›´

### 5.2. åŸå­åŒ–åŸåˆ™

- **å•ä¸€èŒè´£**: æ¯ä¸ªå‡½æ•°åªåšä¸€ä»¶äº‹æƒ…ï¼Œæœ‰ä¸”ä»…æœ‰ä¸€ä¸ªæ”¹å˜çš„ç†ç”±
- **æ¸…æ™°å‘½å**: å‡½æ•°ååº”å‡†ç¡®æè¿°å…¶åŠŸèƒ½ï¼Œæ— éœ€æŸ¥çœ‹å®ç°å³å¯ç†è§£ç”¨é€”
- **å‚æ•°æ§åˆ¶**: å‡½æ•°å‚æ•°ä¸è¶…è¿‡5ä¸ªï¼Œè¶…è¿‡æ—¶åº”è€ƒè™‘ä½¿ç”¨ç»“æ„ä½“å°è£…
- **è¿”å›å€¼ç®€æ´**: ä¼˜å…ˆä½¿ç”¨æ˜ç¡®çš„è¿”å›ç±»å‹ï¼Œé¿å…è¿”å›å¤šä¸ªä¸ç›¸å…³çš„å€¼
- **åµŒå¥—æ§åˆ¶**: é¿å…è¿‡æ·±çš„åµŒå¥—ï¼Œå»ºè®®ä¸è¶…è¿‡4å±‚ç¼©è¿›

### 5.3. å‡½æ•°æ‹†åˆ†ç­–ç•¥

å½“å‡½æ•°è¶…è¿‡40è¡Œæ—¶ï¼Œåº”è€ƒè™‘ä»¥ä¸‹æ‹†åˆ†ç­–ç•¥ï¼š

#### 5.3.1. æŒ‰é€»è¾‘æ­¥éª¤æ‹†åˆ†
```go
// ä¸æ¨èï¼šè¶…é•¿å‡½æ•°
func CreateUserProfile(req *CreateUserRequest) (*User, error) {
    // éªŒè¯è¾“å…¥ (10è¡Œ)
    // æ£€æŸ¥ç”¨æˆ·åé‡å¤ (8è¡Œ)
    // ç”Ÿæˆå¯†ç å“ˆå¸Œ (5è¡Œ)
    // æ„é€ ç”¨æˆ·å¯¹è±¡ (10è¡Œ)
    // ä¿å­˜åˆ°æ•°æ®åº“ (8è¡Œ)
    // å‘é€æ¬¢è¿é‚®ä»¶ (10è¡Œ)
    // è®°å½•æ“ä½œæ—¥å¿— (5è¡Œ)
    // è¿”å›ç»“æœå¤„ç† (5è¡Œ)
}

// æ¨èï¼šæ‹†åˆ†ä¸ºå¤šä¸ªå‡½æ•°
func CreateUserProfile(req *CreateUserRequest) (*User, error) {
    if err := validateCreateUserRequest(req); err != nil {
        return nil, err
    }
    
    if err := checkUsernameAvailability(req.Username); err != nil {
        return nil, err
    }
    
    user := buildUserFromRequest(req)
    if err := saveUserToDatabase(user); err != nil {
        return nil, err
    }
    
    go sendWelcomeEmail(user.Email) // å¼‚æ­¥å¤„ç†
    go logUserCreation(user.ID)     // å¼‚æ­¥å¤„ç†
    
    return user, nil
}
```

#### 5.3.2. æŒ‰ä¸šåŠ¡é¢†åŸŸæ‹†åˆ†
```go
// æ¨èï¼šæ¯ä¸ªå‡½æ•°ä¸“æ³¨äºç‰¹å®šä¸šåŠ¡é¢†åŸŸ
func validateCreateUserRequest(req *CreateUserRequest) error { ... }
func checkUsernameAvailability(username string) error { ... }
func buildUserFromRequest(req *CreateUserRequest) *User { ... }
func saveUserToDatabase(user *User) error { ... }
func sendWelcomeEmail(email string) { ... }
func logUserCreation(userID string) { ... }
```

### 5.4. ä¾‹å¤–æƒ…å†µ

åœ¨ä»¥ä¸‹ç‰¹æ®Šæƒ…å†µä¸‹ï¼Œå¯ä»¥é€‚å½“æ”¾å®½é•¿åº¦é™åˆ¶ï¼š

- **å¸¸é‡å®šä¹‰å‡½æ•°**: åŒ…å«å¤§é‡å¸¸é‡å®šä¹‰çš„åˆå§‹åŒ–å‡½æ•°
- **è·¯ç”±æ³¨å†Œå‡½æ•°**: é›†ä¸­æ³¨å†Œå¤§é‡è·¯ç”±çš„å‡½æ•°
- **é…ç½®æ˜ å°„å‡½æ•°**: å¤„ç†å¤æ‚é…ç½®æ˜ å°„çš„å‡½æ•°
- **æ•°æ®è½¬æ¢å‡½æ•°**: å¤„ç†å¤æ‚æ•°æ®ç»“æ„è½¬æ¢çš„çº¯å‡½æ•°

**æ³¨æ„**: å³ä½¿åœ¨ä¾‹å¤–æƒ…å†µä¸‹ï¼Œä¹Ÿåº”è¯¥ä¼˜å…ˆè€ƒè™‘æ‹†åˆ†ï¼Œåªæœ‰åœ¨æ‹†åˆ†ä¼šæ˜¾è‘—é™ä½ä»£ç å¯è¯»æ€§æ—¶æ‰ä¿æŒæ•´ä½“ã€‚

### 5.5. ä»£ç è´¨é‡æ£€æŸ¥

- **lintæ£€æŸ¥**: ä½¿ç”¨ `golangci-lint` çš„ `funlen` è§„åˆ™æ£€æŸ¥å‡½æ•°é•¿åº¦
- **ä»£ç å®¡æŸ¥**: åœ¨PRå®¡æŸ¥ä¸­é‡ç‚¹å…³æ³¨è¶…é•¿å‡½æ•°çš„åˆç†æ€§
- **é‡æ„æé†’**: å½“å‡½æ•°è¶…è¿‡30è¡Œæ—¶ï¼Œåº”ä¸»åŠ¨è€ƒè™‘æ˜¯å¦éœ€è¦é‡æ„

### 5.6. æœ€ä½³å®è·µç¤ºä¾‹

#### âœ… å¥½çš„ç¤ºä¾‹ - åŸå­åŒ–å‡½æ•°
```go
// Logicå±‚ï¼šç”¨æˆ·ç™»å½•é€»è¾‘
func (l *LoginLogic) Login(req *types.LoginReq) (*types.LoginReply, error) {
    user, err := l.validateUserCredentials(req.Username, req.Password)
    if err != nil {
        return nil, err
    }
    
    token, err := l.generateAuthToken(user.ID)
    if err != nil {
        return nil, err
    }
    
    l.recordLoginAttempt(user.ID, true)
    
    return &types.LoginReply{
        AccessToken:  token.AccessToken,
        AccessExpire: token.ExpiresIn,
    }, nil
}

// è¾…åŠ©å‡½æ•°ï¼šéªŒè¯ç”¨æˆ·å‡­æ®
func (l *LoginLogic) validateUserCredentials(username, password string) (*model.User, error) {
    user, err := l.svcCtx.UserDAO.GetByUsername(l.ctx, username)
    if err != nil {
        return nil, common.ErrUserNotFound
    }
    
    if !l.svcCtx.PasswordUtil.Verify(password, user.Password) {
        return nil, common.ErrInvalidPassword
    }
    
    if !user.IsActive() {
        return nil, common.ErrUserDisabled
    }
    
    return user, nil
}
```

#### âŒ ä¸å¥½çš„ç¤ºä¾‹ - è¿‡é•¿å‡½æ•°
```go
// é¿å…ï¼šè¶…é•¿å‡½æ•°åŒ…å«å¤šä¸ªèŒè´£
func (l *LoginLogic) Login(req *types.LoginReq) (*types.LoginReply, error) {
    // 50+ è¡Œçš„å¤æ‚é€»è¾‘ï¼ŒåŒ…å«ï¼š
    // - å‚æ•°éªŒè¯
    // - ç”¨æˆ·æŸ¥è¯¢
    // - å¯†ç éªŒè¯
    // - æƒé™æ£€æŸ¥
    // - Tokenç”Ÿæˆ
    // - ç¼“å­˜æ›´æ–°
    // - æ—¥å¿—è®°å½•
    // - å“åº”æ„é€ 
    // ...
}
```

## 6. é…ç½®ä¸æ•°æ®åº“

### 6.1. é…ç½®æ–‡ä»¶è§„èŒƒ

- **é…ç½®**:
  - ä¸¥ç¦åœ¨ä»£ç ä¸­ç¡¬ç¼–ç ä»»ä½•é…ç½®é¡¹ï¼ˆç«¯å£ã€æ•°æ®åº“åœ°å€ã€å¯†é’¥ç­‰ï¼‰ã€‚æ‰€æœ‰é…ç½®éƒ½å¿…é¡»åœ¨ `etc/*.yaml` æ–‡ä»¶ä¸­å®šä¹‰ã€‚
  - å¯¹äºæ•æ„Ÿä¿¡æ¯ï¼ˆå¦‚å¯†ç ã€API Keyï¼‰ï¼Œæ¨èé€šè¿‡ç¯å¢ƒå˜é‡åŠ è½½ï¼Œå¹¶åœ¨é…ç½®æ–‡ä»¶ä¸­ä½¿ç”¨ `env()` è¯­æ³•ã€‚

### 6.2. é…ç½®ç»“æ„ä½“è®¾è®¡è¦ç‚¹

#### âš ï¸ é‡è¦ï¼šé¿å…ä¸go-zeroå†…ç½®é…ç½®å­—æ®µå†²çª

åœ¨è®¾è®¡è‡ªå®šä¹‰é…ç½®ç»“æ„ä½“æ—¶ï¼Œå¿…é¡»é¿å…ä¸go-zeroæ¡†æ¶å†…ç½®çš„é…ç½®å­—æ®µåå†²çªã€‚å¸¸è§çš„å†²çªå­—æ®µåŒ…æ‹¬ï¼š

- `Log` - go-zeroçš„æ—¥å¿—é…ç½®å­—æ®µ
- `Timeout` - go-zeroçš„è¶…æ—¶é…ç½®å­—æ®µ
- `Host` - æœåŠ¡ç›‘å¬åœ°å€å­—æ®µ
- `Port` - æœåŠ¡ç›‘å¬ç«¯å£å­—æ®µ

**âŒ é”™è¯¯ç¤ºä¾‹**:
```go
type Config struct {
    rest.RestConf
    Log struct {  // âŒ ä¸go-zeroå†…ç½®Logå­—æ®µå†²çª
        Level string
    }
    Timeout struct {  // âŒ ä¸go-zeroå†…ç½®Timeoutå­—æ®µå†²çª
        Read  int
        Write int
    }
}
```

**âœ… æ­£ç¡®ç¤ºä¾‹**:
```go
type Config struct {
    rest.RestConf
    
    // ä½¿ç”¨ä¸åŒçš„å­—æ®µåé¿å…å†²çª
    LogConfig struct {
        Level string
    } `json:",optional"`
    
    TimeoutConfig struct {
        Read  int
        Write int
    } `json:",optional"`
    
    // æˆ–è€…ä½¿ç”¨æ›´å…·ä½“çš„ä¸šåŠ¡åç§°
    ApplicationLog struct {
        Level string
    } `json:",optional"`
    
    DatabaseTimeout struct {
        Connect int
        Query   int
    } `json:",optional"`
}
```

#### ğŸ”§ å†²çªè§£å†³æ–¹æ¡ˆ

1. **é‡å‘½åç­–ç•¥**: ä¸ºè‡ªå®šä¹‰é…ç½®å­—æ®µæ·»åŠ å‰ç¼€æˆ–åç¼€
   - `Log` â†’ `LogConfig` æˆ– `ApplicationLog`
   - `Timeout` â†’ `TimeoutConfig` æˆ– `DatabaseTimeout`

2. **åµŒå¥—ç­–ç•¥**: å°†ç›¸å…³é…ç½®åˆ†ç»„åˆ°å­ç»“æ„ä½“ä¸­
   ```go
   type Config struct {
       rest.RestConf
       
       App struct {
           Log struct {
               Level string
           }
           Timeout struct {
               Read  int
               Write int
           }
       }
   }
   ```

3. **å¯é€‰æ ‡ç­¾**: å¯¹è‡ªå®šä¹‰å­—æ®µä½¿ç”¨ `json:",optional"` æ ‡ç­¾ï¼Œé¿å…å¿…å¡«éªŒè¯å†²çª

#### ğŸ› ï¸ æ•…éšœæ’æŸ¥

å¦‚æœé‡åˆ°ä»¥ä¸‹é”™è¯¯ï¼Œé€šå¸¸æ˜¯é…ç½®å­—æ®µå†²çªå¯¼è‡´çš„ï¼š
- æœåŠ¡å¯åŠ¨æ—¶é…ç½®éªŒè¯å¤±è´¥
- é…ç½®æ–‡ä»¶è§£æé”™è¯¯
- æ„å¤–çš„é…ç½®é»˜è®¤å€¼è¢«è¦†ç›–

**è§£å†³æ­¥éª¤**:
1. æ£€æŸ¥è‡ªå®šä¹‰é…ç½®ç»“æ„ä½“æ˜¯å¦æœ‰ä¸go-zeroå†…ç½®å­—æ®µåŒåçš„å­—æ®µ
2. é‡å‘½åå†²çªå­—æ®µæˆ–è°ƒæ•´ç»“æ„ä½“è®¾è®¡
3. æ›´æ–°å¯¹åº”çš„YAMLé…ç½®æ–‡ä»¶ä¸­çš„å­—æ®µå
4. é‡æ–°ç”Ÿæˆä»£ç å¹¶æµ‹è¯•

### 6.3. æ•°æ®åº“é…ç½®

- **æ•°æ®åº“**:
  - æˆ‘ä»¬ä½¿ç”¨ MongoDB ä½œä¸ºä¸»æ•°æ®åº“ï¼Œé€šè¿‡å®˜æ–¹çš„ `go.mongodb.org/mongo-driver` ä¸æ•°æ®åº“äº¤äº’ã€‚
  - æ•°æ®åº“è¿æ¥å¯¹è±¡åœ¨ `svc.ServiceContext` ä¸­åˆå§‹åŒ–å¹¶æŒæœ‰ã€‚
  - `logic` å±‚**ä¸åº”**ç›´æ¥æ“ä½œ MongoDB é©±åŠ¨ï¼Œè€Œåº”è°ƒç”¨ `dao` å±‚æä¾›çš„æ–¹æ³•æ¥å®Œæˆæ•°æ®æ“ä½œã€‚

## 7. å¸¸é‡ç®¡ç†

ä¸ºäº†æé«˜ä»£ç çš„å¯ç»´æŠ¤æ€§ã€å¯è¯»æ€§å¹¶é¿å…é­”æ³•å­—ç¬¦ä¸² (Magic Strings)ï¼Œé¡¹ç›®ä¸­æ‰€æœ‰å¯å¤ç”¨çš„ã€å…·æœ‰ä¸šåŠ¡å«ä¹‰çš„å­—ç¬¦ä¸²æˆ–æ•°å­—éƒ½å¿…é¡»å®šä¹‰ä¸ºå¸¸é‡ã€‚

### 7.1. å¸¸é‡å®šä¹‰ä½ç½®

- **å…±äº«å¸¸é‡**: åœ¨ `common/constants/` ç›®å½•ä¸‹å®šä¹‰ä¸¤ä¸ªæœåŠ¡éƒ½ä¼šä½¿ç”¨çš„å¸¸é‡
- **æœåŠ¡ç‰¹æœ‰å¸¸é‡**: åœ¨å„è‡ªæœåŠ¡çš„ `internal/constants/` ç›®å½•ä¸‹å®šä¹‰åªæœ‰è¯¥æœåŠ¡ä½¿ç”¨çš„å¸¸é‡
- **æŒ‰é¢†åŸŸåˆ†ç±»**: æ ¹æ®å¸¸é‡çš„ä¸šåŠ¡é¢†åŸŸå°†å…¶åˆ†æ•£åˆ°ä¸åŒçš„æ–‡ä»¶ä¸­

### 7.2. å¸¸é‡å®šä¹‰ç¤ºä¾‹

**å…±äº«å¸¸é‡** (`common/constants/`):

- `common/constants/post_constants.go`:
  ```go
  package constants

  const (
      // æ–‡ç« çŠ¶æ€
      PostStatusPublished = "published"
      PostStatusDraft     = "draft"
      PostStatusArchived  = "archived"
      PostStatusScheduled = "scheduled"
  )
  ```

- `common/constants/user_constants.go`:
  ```go
  package constants

  const (
      // ç”¨æˆ·è§’è‰²
      RoleOwner   = "Owner"        // åšå®¢æ‰€æœ‰è€…
      RoleAdmin   = "Admin"        // ç®¡ç†å‘˜
      RoleEditor  = "Editor"       // ç¼–è¾‘
      RoleAuthor  = "Author"       // ä½œè€…
      RoleViewer  = "Viewer"       // è®¿å®¢/ä¼šå‘˜
  )
  ```

**æœåŠ¡ç‰¹æœ‰å¸¸é‡** (å¦‚ `admin-api/admin/internal/constants/`):

- `admin-api/admin/internal/constants/context_constants.go`:
  ```go
  package constants

  type ContextKey string

  const (
      CtxKeyUserID   ContextKey = "userID"
      CtxKeyUserRole ContextKey = "userRole"
  )
  ```

### 7.3. å¼•ç”¨è§„èŒƒ

- **å¼•ç”¨å…±äº«å¸¸é‡**: `import "github.com/heimdall-api/common/constants"`
- **å¼•ç”¨æœåŠ¡å¸¸é‡**: `import "github.com/heimdall-api/admin-api/admin/internal/constants"` 